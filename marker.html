<html>
  <head>
    <title>Default Data Layer: Earthquakes</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>

    
    <style>
        /* 
 * Always set the map height explicitly to define the size of the div element
 * that contains the map. 
 */
#map {
    height: 100%;
  }
  
  /* 
   * Optional: Makes the sample page fill the window. 
   */
  html,
  body {
    height: 100%;
    margin: 0;
    padding: 0;
  }
    </style>
  </head>
  <body>
    <h1>Hello World</h1>
    <div id="map"></div>

    <!-- 
      The `defer` attribute causes the callback to execute after the full HTML
      document has been parsed. For non-blocking uses, avoiding race conditions,
      and consistent behavior across browsers, consider loading using Promises.
      See https://developers.google.com/maps/documentation/javascript/load-maps-js-api
      for more information.
      -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC-a-5lXv4V7Lwuql39W8qzH-VPfCywIW4&callback=initMap&v=weekly"
      defer
    ></script>
    <script>
        let map;
        let infoWindow;

        function getMarkerColor(aqi) {
            if (aqi <= 50) {
                return 'green'; // Good
            } else if (aqi <= 100) {
                return 'yellow'; // Moderate
            } else if (aqi <= 150) {
                return 'orange'; // Unhealthy for Sensitive Groups
            } else if (aqi <= 200) {
                return 'red'; // Unhealthy
            } else if (aqi <= 300) {
                return 'purple'; // Very Unhealthy
            } else {
                return 'maroon'; // Hazardous
            }
        }
        function initMap() {
          map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: 54.3781, lng: -2.2137 }, // Centered on the UK
            zoom: 6,
          });
      
          // Create an InfoWindow
          infoWindow = new google.maps.InfoWindow();
          // List of cities and states in the UK
          const citiesAndStates = [
            { city: "London", state: "England" },
            { city: "Edinburgh", state: "Scotland" },
            { city: "Cardiff", state: "Wales" },
            { city: "Belfast", state: "Northern Ireland" },
            // Add more cities and states as needed
          ];
      
          const apiKey = "a2f30b6e-6ae9-4b0e-bda1-d25abc169d23";
          
      
          // Fetch air quality data for each city and state combination
          citiesAndStates.forEach(({ city, state }) => {
            const apiUrl = `http://api.airvisual.com/v2/city?city=${city}&state=${state}&country=UK&key=${apiKey}`;
      
            fetch(apiUrl)
              .then(response => response.json())
              .then(data => {
                // Extract air quality index information from the response
                const airQualityIndex = data.data.current.pollution.aqius;
                
                const markerColor = getMarkerColor(airQualityIndex);
                // Create a marker for the city with air quality index information
                const marker = new google.maps.Marker({
                  position: { lat: data.data.location.coordinates[1], lng: data.data.location.coordinates[0] },
                  map: map,
                  title: `${city}, ${state}\nAir Quality Index: ${airQualityIndex}`,
                  label: airQualityIndex.toString(),
                  icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                            fillColor: markerColor,
                            fillOpacity: 1.0,
                            strokeWeight: 0.,
                            scale: 10
                },
                });
                
                    // Add a click event listener to the marker
                    marker.addListener('click', () => {

                        const pollutionData = data.data.current.pollution;
                        const weatherData = data.data.current.weather;

                        const infoContent =`<div>
                            <h3>${city}, ${state}</h3>
                        <p>Air Quality Index: ${airQualityIndex}</p>
                        <a href="moreinfo.html?city=${encodeURIComponent(city)}&state=${encodeURIComponent(state)}">More Info</a>
                        </div>`;
                        // Set the content of the InfoWindow
                        infoWindow.setContent(infoContent);

                        // Open the InfoWindow
                        infoWindow.open(map, marker);

                        // Zoom in to the marker's location
                        map.setZoom(10); // Adjust the zoom level as needed
                        map.setCenter(marker.getPosition());
                    });
                
              })
              
              .catch(error => {
                console.error(`Error fetching air quality data for ${city}, ${state}:`, error);
              });
          });
         
        }
      
        window.initMap = initMap;
      </script>
      
      
  </body>
</html>